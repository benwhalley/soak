name: zero_shot_pre_extract
default_context:
  persona: Experienced qualitative researcher
  research_question: None

nodes:
  - name: chunks
    type: Split
    chunk_size: 30000

  - name: extract_relevant_excepts
    type: Map
    inputs:
      - chunks
      
  - name: chunk_codes_and_themes
    type: Map
    max_tokens: 16000
    inputs:
      - extract_relevant_excepts

  - name: all_codes
    type: Reduce
    inputs:
      - chunk_codes_and_themes

  - name: all_themes
    type: Reduce
    inputs:
      - chunk_codes_and_themes

  - name: codes
    type: Transform
    max_tokens: 32000
    inputs:
      - all_codes

  - name: themes
    type: Transform
    max_tokens: 32000
    inputs:
      - codes
      - all_themes


  - name: narrative
    type: Transform
    inputs:
      - themes
      - codes


---#chunks

{{input}}



---#extract_relevant_excepts

You are a: {{persona}}
You are pre-reading qualitative transcripts to identify the most relevant exceptions to the research question. 
You will extract text from the interview according to the following criteria:
- only patients' speech (not the interviewer, unless necessary to provide context)
- EXACTLY the text from the transcript, VERBATIM, with no amendments
- only the sections that are relevant to the research question

<transcribed text>

{{input}}

</transcribed text>


## Your task

Extract elements of the text relevant to the research question:

{{excerpt_topics}}

Copy text related to this question/topic verbatim. Do not add any additional text.
Format with simple markdown if needed.

[[extract:relevant_content]]


---#chunk_codes_and_themes

You are a: {{persona}}

You will code the transcript independently, without using a pre-existing codebook. This is the initial coding stage, where insights will be drawn directly from the text. The results from this stage will determine the subsequent theme generation process.

{{research_question}}

You are provided text from transcripts of interviews with participants who took part in the study.

In this stage, you will generate codes. Codes are the foundational units of inductive thematic analysis, capturing significant concepts and ideas from the transcripts. Each code includes a concise name, a meaningful description, and representative quotes from the transcripts.

In this task, a 'code' should be related to the desires, needs, and meaningful outcomes for participants. Codes pertain to participants. Codes describe the feeling of the participant themselves.

Your goal is to carefully look through the text and identify all codes discussed by the participant exhaustively. Each code should be specific and distinct without overlaps.

Identify all relevant codes in the text, provide a Name for each code in 8 to 15 words in sentence case.

Write with concise, concrete details and avoid clichés, generalizations.

Give a dense Description of the code in 50 words and direct quotes from the participant for each code. These quotes can consist of multiple excerpts from the text. Use ellipses to shorten quotes as needed.

Try to use the language the participants use when generating the names and descriptions.

Use language like an inductive thematic analysis researcher would do when generating the names and descriptions.

Avoid generalized terms and use specific terms from the quotes when generating code name and description. Be concise. 

<text>
{{input}}
</text>


[[codes:codes]]

Next is the theme identification stage. Above are initial codes: text that has initial codes with their descriptions and relevant quotes.

Your task now is to group the initial codes into distinct themes based on the initial codes, descriptions, and quotes.

A 'theme' is the wants, needs, meaningful outcomes, and lived experiences of participants.

Themes:

- pertain to participants.
- describe the feeling of the participants themselves.
- should be specific and distinct.
- can relate to multiple codes
- can 'share' codes with other themes

### Instructions

- Provide a clear, specific name of 5 to 10 words for each theme.

- Write with concise, concrete details and avoid clichés, generalizations. Avoid the word 'Navigating' or other cliches from qual research.

- Ensure the theme name captures the essence of the concept and is not too general/specific. It must be instantly comprehended by the reader and bring to mind/evoke the ideas/concepts captured by the theme.

- Provide a rich description of around 50 words for each theme. This is a detailed description of the theme which captures the full range of meanings and nuances of the concept.

- Use the language and specific words of quotes and code-descriptions when generating the theme description. Use personal and domain-specific language and avoid generalized terms.

TASK Now
Create themes from the codes above

[[themes:themes]]

---#all_codes

{{input.codes}}


---#all_themes

{{input.themes}}

---#codes

You are a: {{persona}}

{{research_question}}

We are now going to rationalise the set of codes identified across multiple documents. We will consolidate into a single CodeList.

## Preliminary codes

<text>
{{all_codes}}
</text>

First, make a short list of notes on the codes we want to keep. Avoid duplicates. Just list the names of the codes we will keep.


[[codenotes]]

Now, form this list of new/aligned codes into the required format.

A code consists of

- A concise name (8-15 words)
- A codename/slug (max 20 letters a-Z)
- A meaningful description (around 50 words)
- Representative quotes from the text (abbreviated with ellipses if needed)

[[codes:codes]]


---#themes

You are a: {{persona}}

{{research_question}}

You are at the final theme generation stage. You are provided preliminary themes, with their descriptions and relevant codes.

These preliminary themes and codes are generated from interview transcripts with participants who took part in the study.

A 'theme' relates to the experience of participants.

Themes pertain to participants. Themes describe the feeling of the participant themselves; how the participant feels about the system and their experience of it.

Review and consolidate the following preliminary themes into major themes.

Each major theme should be clearly distinct from the others. Avoid overlap.

The major themes will be used to write the final report.

A code can appear-in/link-to multiple major themes if relevant.
List all the relevant codes under each major theme.


- Provide a clear, specific name of 5 to 10 words for each theme.

- Write with concise, concrete details and avoid clichés, generalizations. Avoid the word 'Navigating' or other cliches from qual research.

- Ensure the theme name captures the essence of the concept and is not too general/specific. It must be instantly comprehended by the reader and bring to mind/evoke the ideas/concepts captured by the theme.

- Provide a rich description of around 50 words for each theme. This is a detailed description of the theme which captures the full range of meanings and nuances of the concept.

- Use the language and specific words of quotes and code-descriptions when generating the theme description. Use personal and domain-specific language and avoid generalized terms.

- Write the final theme name in sentence case.

Act like an Inductive Thematic Analysis researcher would when conducting this Inductive Thematic Analysis for generating the name and descriptions of the themes.


TASK NOW
Review and consolidate the following preliminary themes into ~7 (+/- 2) overarching major themes. Use fewer themes if there is too much overlap. Combine themes if they overlap in meaning, or there are too many themes.

Complete list of codes identified:

{{codes}}

Preliminary themes:

{{all_themes}}

Produce a single list of themes in the correct format.
Max 10 themes.
Themes must be distinct.
Together, the themes must encompass _all_ the topics/concepts identified.  
Use the tools.

[[themes:themes]]


---#narrative

Below are the results of a thematic analysis. 
We list the codes and themes which are formed from them.
Read this carefully — we will write a narrative report based on these results.

## CODES

{{codes}}


## THEMES

{{themes}}


## TASK

Write this up as a standard qualitative report, ready copying and pasting into the results section
of an academic journal. 
Don't include titles, intro, citations or extended discussion — this is just the result of the analysis.
Be brief - about 1 paragraph per theme. Make sure to include quotes for each theme which explain and bring the theme to life for readers. Do not edit quotes. No preamble - just report. Use simple markdown. Make the theme names bold face.

[[report]]